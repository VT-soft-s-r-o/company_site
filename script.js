// Language translations
const translations = {
    en: {
        "title": "VT-soft - Professional Software Development Services",
        "nav.about": "About",
        "nav.expertise": "Expertise",
        "nav.experience": "Experience",
        "nav.companies": "Companies",
        "nav.contact": "Contact",
        
        "hero.title": "Professional Software Development",
        "hero.subtitle": "Delivering high-quality solutions with over 15 years of experience",
        "hero.cta": "Get In Touch",
        
        "about.title": "About VT-soft",
        "about.intro": "VT-soft is led by Tomáš Chabada, Ing., a software engineer with extensive experience in delivering enterprise-level software solutions. With a proven track record across international projects and Fortune 500 companies, we bring expertise, reliability, and innovation to every project.",
        "about.attributes.title": "Professional Attributes",
        "about.attributes.reliable": "Reliable",
        "about.attributes.motivated": "Self-motivated",
        "about.attributes.detail": "Detail oriented",
        "about.attributes.organized": "Organized",
        "about.attributes.adaptable": "Adaptable",
        "about.attributes.communicative": "Communicative",
        "about.attributes.innovative": "Innovative",
        "about.attributes.team": "Team player",
        "about.credentials.title": "Credentials",
        "about.credentials.education1": "Master's Degree",
        "about.credentials.education1.school": "University of Žilina, Faculty of Informatics and Management (2011)",
        "about.credentials.cert2": "Microsoft ASP.NET Core MVC",
        "about.credentials.cert3": "Microsoft SQL Performance Optimization",
        
        "expertise.title": "Technical Expertise",
        "expertise.backend": "Backend Development",
        "expertise.frontend": "Frontend Development",
        "expertise.cloud": "Cloud & DevOps",
        "expertise.database": "Database & Data",
        
        "experience.title": "Professional Experience",
        "experience.present": "Present",
        "experience.localhost.project": "Project for Caterpillar (Remote Fleet Vision)",
        "experience.localhost.detail1": "Developing microservices-based application managing Caterpillar's assets",
        "experience.localhost.detail2": "Working in international team across Slovakia, USA, and Canada",
        "experience.localhost.detail3": "Technologies: .NET 8, Azure DevOps, Angular, ServiceFabric, MS SQL Server",
        "experience.wisdom.project": "Project for Cera Care (Healthcare-at-Home, UK)",
        "experience.wisdom.detail1": "Developed scheduling application for patient visits across UK",
        "experience.wisdom.detail2": "International collaboration with teams in Slovakia, Portugal, UK, and Serbia",
        "experience.wisdom.detail3": "Technologies: C#, AWS, .NET 6.0, Terraform, MySQL, Microservices",
        "experience.ocuco.detail1": "Developed WebAPI services using Domain-Driven Development",
        "experience.ocuco.detail2": "Contributed to React frontend development",
        "experience.ocuco.detail3": "Technologies: C#, .NET 6.0, React, Azure, Azure Cognitive Search, Specflow",
        "experience.sonalake.project": "Project for Ocuco Limited (Optical Software)",
        "experience.sonalake.detail1": "WebAPI service development in international team",
        "experience.sonalake.detail2": "Unit testing and Specflow integration tests",
        "experience.sonalake.detail3": "Technologies: C#, .NET 6.0, React, Azure, EF Core 6",
        "experience.doxxbet.projects": "Multiple Major Projects:",
        "experience.doxxbet.detail1": "<strong>Betting Terminal (SportBox)</strong> - ~1,000 devices across Europe & Africa",
        "experience.doxxbet.detail2": "<strong>PKI Project</strong> - Client certificates infrastructure (x509 v2)",
        "experience.doxxbet.detail3": "<strong>New Feed System</strong> - Scalable infrastructure using Apache Kafka",
        "experience.doxxbet.detail4": "<strong>Casino Games Integration</strong> - Wallet service with Elasticsearch analytics",
        "experience.doxxbet.detail5": "Main responsibility for architecture and design decisions",
        "experience.contalok.project": "Security Access System - Contal Nova",
        "experience.contalok.detail1": "Embedded devices development (.NET Compact Framework)",
        "experience.contalok.detail2": "MIFARE card encoding and licensing software",
        "experience.contalok.detail3": "Direct customer communication and feature development",
        
        "companies.title": "Trusted by Leading Companies",
        "companies.subtitle": "Experience working with international organizations across multiple industries",
        "companies.cat.industry": "Construction & Mining Equipment",
        "companies.cat.desc": "Remote fleet vision project for asset management",
        "companies.cera.name": "CERA CARE",
        "companies.cera.type": "Digital Healthcare",
        "companies.cera.desc": "Healthcare-at-home patient scheduling system",
        "companies.ocuco.type": "Optical Software Leader",
        "companies.ocuco.desc": "Acuitas optical management platform",
        "companies.sonalake.type": "Software Development",
        "companies.sonalake.desc": "Enterprise software solutions for healthcare and retail",
        "companies.doxxbet.type": "Gaming & Betting",
        "companies.doxxbet.desc": "Betting terminals and casino platform (1000+ devices)",
        "companies.localhost.type": "Software Development",
        "companies.localhost.desc": "Current employer, contracting for Fortune 500 companies",
        
        "contact.title": "Get In Touch",
        "contact.subtitle": "Let's discuss how we can help with your next project",
        "contact.email.label": "Email",
        "contact.phone.label": "Phone",
        "contact.location.label": "Location",
        
        "footer.rights": "All rights reserved.",
        "footer.founder": "Founded by Tomáš Chabada, Ing."
    },
    sk: {
        "title": "VT-soft - Profesionálny vývoj softvéru",
        "nav.about": "O nás",
        "nav.expertise": "Odbornosť",
        "nav.experience": "Skúsenosti",
        "nav.companies": "Spoločnosti",
        "nav.contact": "Kontakt",
        
        "hero.title": "Profesionálny vývoj softvéru",
        "hero.subtitle": "Dodávame vysokokvalitné riešenia s viac ako 15-ročnými zkúsenosťami",
        "hero.cta": "Kontaktujte nás",
        
        "about.title": "O spoločnosti VT-soft",
        "about.intro": "VT-soft vedie Tomáš Chabada, Ing., softvérový inžinier s rozsiahlymi skúsenosťami v dodávaní softvérových riešení na podnikovej úrovni. S preukázateľnými výsledkami v medzinárodných projektoch a pre Fortune 500 spoločnosti prinášame odbornosť, spoľahlivosť a inovácie do každého projektu.",
        "about.attributes.title": "Profesionálne vlastnosti",
        "about.attributes.reliable": "Spoľahlivý",
        "about.attributes.motivated": "Samoštartovač",
        "about.attributes.detail": "Orientovaný na detaily",
        "about.attributes.organized": "Organizovaný",
        "about.attributes.adaptable": "Prispôsobivý",
        "about.attributes.communicative": "Komunikatívny",
        "about.attributes.innovative": "Inovatívny",
        "about.attributes.team": "Tímový hráč",
        "about.credentials.title": "Certifikáty a vzdelanie",
        "about.credentials.education1": "Inžiniersky titul",
        "about.credentials.education1.school": "Žilinská univerzita, Fakulta riadenia a informatiky (2011)",
        "about.credentials.cert2": "Microsoft ASP.NET Core MVC",
        "about.credentials.cert3": "Microsoft SQL optimalizácia výkonu",
        
        "expertise.title": "Technická odbornosť",
        "expertise.backend": "Backend vývoj",
        "expertise.frontend": "Frontend vývoj",
        "expertise.cloud": "Cloud & DevOps",
        "expertise.database": "Databázy a dáta",
        
        "experience.title": "Profesionálne skúsenosti",
        "experience.present": "Súčasnosť",
        "experience.localhost.project": "Projekt pre Caterpillar (Remote Fleet Vision)",
        "experience.localhost.detail1": "Vývoj aplikácie na báze mikroslužieb pre správu aktív spoločnosti Caterpillar",
        "experience.localhost.detail2": "Práca v medzinárodnom tíme na Slovensku, v USA a Kanade",
        "experience.localhost.detail3": "Technológie: .NET 8, Azure DevOps, Angular, ServiceFabric, MS SQL Server",
        "experience.wisdom.project": "Projekt pre Cera Care (Zdravotná starostlivosť doma, UK)",
        "experience.wisdom.detail1": "Vývoj plánovacej aplikácie pre návštevy pacientov vo Veľkej Británii",
        "experience.wisdom.detail2": "Medzinárodná spolupráca s tímami na Slovensku, v Portugalsku, UK a Srbsku",
        "experience.wisdom.detail3": "Technológie: C#, AWS, .NET 6.0, Terraform, MySQL, Mikroslužby",
        "experience.ocuco.detail1": "Vývoj WebAPI služieb pomocou Domain-Driven Development",
        "experience.ocuco.detail2": "Prispievanie k vývoju React frontendu",
        "experience.ocuco.detail3": "Technológie: C#, .NET 6.0, React, Azure, Azure Cognitive Search, Specflow",
        "experience.sonalake.project": "Projekt pre Ocuco Limited (Optický softvér)",
        "experience.sonalake.detail1": "Vývoj WebAPI služieb v medzinárodnom tíme",
        "experience.sonalake.detail2": "Unit testy a Specflow integračné testy",
        "experience.sonalake.detail3": "Technológie: C#, .NET 6.0, React, Azure, EF Core 6",
        "experience.doxxbet.projects": "Viacero významných projektov:",
        "experience.doxxbet.detail1": "<strong>Stávkový terminál (SportBox)</strong> - ~1 000 zariadení v Európe a Afrike",
        "experience.doxxbet.detail2": "<strong>PKI projekt</strong> - Infraštruktúra klientských certifikátov (x509 v2)",
        "experience.doxxbet.detail3": "<strong>Nový feedový systém</strong> - Škálovateľná infraštruktúra využívajúca Apache Kafka",
        "experience.doxxbet.detail4": "<strong>Integrácia kasínových hier</strong> - Služba peňaženky s Elasticsearch analytickými nástrojmi",
        "experience.doxxbet.detail5": "Hlavná zodpovednosť za architektúru a dizajnové rozhodnutia",
        "experience.contalok.project": "Bezpečnostný prístupový systém - Contal Nova",
        "experience.contalok.detail1": "Vývoj pre vstavané zariadenia (.NET Compact Framework)",
        "experience.contalok.detail2": "MIFARE kódovanie kariet a licenčný softvér",
        "experience.contalok.detail3": "Priama komunikácia so zákazníkmi a vývoj funkcií",
        
        "companies.title": "Dôveryhodný partner popredných spoločností",
        "companies.subtitle": "Skúsenosti s prácou pre medzinárodné organizácie v rôznych odvetviach",
        "companies.cat.industry": "Stavebné a ťažobné zariadenia",
        "companies.cat.desc": "Projekt diaľkovej správy vozového parku",
        "companies.cera.name": "CERA CARE",
        "companies.cera.type": "Digitálna zdravotná starostlivosť",
        "companies.cera.desc": "Systém plánovania návštev pacientov v domácom prostredí",
        "companies.ocuco.type": "Líder v optickom softvéri",
        "companies.ocuco.desc": "Platforma pre správu optických služieb Acuitas",
        "companies.sonalake.type": "Vývoj softvéru",
        "companies.sonalake.desc": "Podnikové softvérové riešenia pre zdravotníctvo a maloobchod",
        "companies.doxxbet.type": "Hazardné hry a stávky",
        "companies.doxxbet.desc": "Stávkové terminály a kasínová platforma (1000+ zariadení)",
        "companies.localhost.type": "Vývoj softvéru",
        "companies.localhost.desc": "Súčasný zamestnávateľ, kontrakt pre Fortune 500 spoločnosti",
        
        "contact.title": "Kontaktujte nás",
        "contact.subtitle": "Poďme prediskutovať, ako vám môžeme pomôcť s vaším ďalším projektom",
        "contact.email.label": "Email",
        "contact.phone.label": "Telefón",
        "contact.location.label": "Lokalita",
        
        "footer.rights": "Všetky práva vyhradené.",
        "footer.founder": "Zakladateľ Tomáš Chabada, Ing."
    }
};

// Current language state
let currentLang = 'en';

// Get language from URL path
function getLanguageFromURL() {
    const path = window.location.pathname;
    // Check if path starts with /sk
    if (path.startsWith('/sk')) {
        return 'sk';
    }
    return 'en';
}

// Initialize on page load
document.addEventListener('DOMContentLoaded', function() {
    // Priority: URL param > localStorage > default 'en'
    const urlLang = getLanguageFromURL();
    const savedLang = localStorage.getItem('preferredLanguage');
    
    if (urlLang !== 'en') {
        // URL parameter has highest priority
        currentLang = urlLang;
    } else if (savedLang && translations[savedLang]) {
        // Use saved preference if no URL param
        currentLang = savedLang;
    }
    
    // Set up language toggle links (segmented control)
    const langLinks = document.querySelectorAll('.lang-btn');
    langLinks.forEach(link => {
        link.addEventListener('click', function(e) {
            e.preventDefault();
            const lang = this.getAttribute('data-lang');
            const url = lang === 'en' ? '/' : '/' + lang;
            switchLanguage(lang, url);
        });
    });

    // Set up dropdown for mobile
    const dropdown = document.querySelector('.lang-dropdown');
    const currentBtn = document.querySelector('.lang-current');
    const menu = document.getElementById('lang-menu');
    const currentLabel = document.querySelector('.current-label');
    const menuOptions = menu ? menu.querySelectorAll('[role="option"]') : [];

    function closeDropdown() {
        if (!dropdown) return;
        dropdown.classList.remove('open');
        if (currentBtn) currentBtn.setAttribute('aria-expanded', 'false');
    }

    function openDropdown() {
        if (!dropdown) return;
        dropdown.classList.add('open');
        if (currentBtn) currentBtn.setAttribute('aria-expanded', 'true');
        // Focus the selected option for accessibility
        const selected = menu.querySelector('[aria-selected="true"]');
        if (selected) selected.focus();
    }

    if (currentBtn && menu) {
        currentBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            if (dropdown.classList.contains('open')) closeDropdown(); else openDropdown();
        });

        // Option selection
        menuOptions.forEach(opt => {
            opt.addEventListener('click', (e) => {
                e.stopPropagation();
                const lang = opt.getAttribute('data-lang');
                const url = opt.getAttribute('data-url') || '/';
                switchLanguage(lang, url);
                closeDropdown();
            });
            opt.addEventListener('keydown', (e) => {
                if (e.key === 'Enter' || e.key === ' ') {
                    e.preventDefault();
                    const lang = opt.getAttribute('data-lang');
                    const url = opt.getAttribute('data-url') || '/';
                    switchLanguage(lang, url);
                    closeDropdown();
                }
            });
        });

        // Close on outside click
        document.addEventListener('click', (e) => {
            if (!dropdown.contains(e.target)) closeDropdown();
        });

        // Close on Escape
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') closeDropdown();
        });
    }
    
    // Apply initial language
    applyLanguage(currentLang);
    updateActiveButton(currentLang);
    if (currentLabel) currentLabel.textContent = currentLang.toUpperCase();
    
    // Smooth scroll for navigation links
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function (e) {
            e.preventDefault();
            const target = document.querySelector(this.getAttribute('href'));
            if (target) {
                target.scrollIntoView({
                    behavior: 'smooth',
                    block: 'start'
                });
            }
        });
    });
    
    // Add scroll animation for timeline items
    addScrollAnimations();
});

// Switch language function
function switchLanguage(lang, url) {
    if (translations[lang] && lang !== currentLang) {
        currentLang = lang;
        localStorage.setItem('preferredLanguage', lang);
        applyLanguage(lang);
        updateActiveButton(lang);
        
        // Update URL without page reload (SEO-friendly)
        if (url) {
            window.history.pushState({ lang: lang }, '', url);
        }
    }
}

// Apply language to all elements with data-i18n attribute
function applyLanguage(lang) {
    const elements = document.querySelectorAll('[data-i18n]');
    elements.forEach(element => {
        const key = element.getAttribute('data-i18n');
        if (translations[lang][key]) {
            element.innerHTML = translations[lang][key];
        }
    });
    
    // Update page title
    if (translations[lang]['title']) {
        document.title = translations[lang]['title'];
    }
    
    // Update HTML lang attribute
    document.documentElement.lang = lang;
}

// Update active button state
function updateActiveButton(lang) {
    const langLinks = document.querySelectorAll('.lang-btn');
    langLinks.forEach(link => {
        if (link.getAttribute('data-lang') === lang) {
            link.classList.add('active');
        } else {
            link.classList.remove('active');
        }
    });

    // Sync dropdown label and listbox selection
    const currentLabel = document.querySelector('.current-label');
    if (currentLabel) currentLabel.textContent = lang.toUpperCase();
    const menu = document.getElementById('lang-menu');
    if (menu) {
        const options = menu.querySelectorAll('[role="option"]');
        options.forEach(opt => {
            const isSelected = opt.getAttribute('data-lang') === lang;
            opt.setAttribute('aria-selected', isSelected ? 'true' : 'false');
        });
    }
}

// Add scroll animations
function addScrollAnimations() {
    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.style.opacity = '1';
                entry.target.style.transform = 'translateY(0)';
            }
        });
    }, {
        threshold: 0.1,
        rootMargin: '0px 0px -50px 0px'
    });
    
    // Observe timeline items
    const timelineItems = document.querySelectorAll('.timeline-item');
    timelineItems.forEach((item, index) => {
        item.style.opacity = '0';
        item.style.transform = 'translateY(20px)';
        item.style.transition = `opacity 0.6s ease ${index * 0.1}s, transform 0.6s ease ${index * 0.1}s`;
        observer.observe(item);
    });
    
    // Observe company cards
    const companyCards = document.querySelectorAll('.company-card');
    companyCards.forEach((card, index) => {
        card.style.opacity = '0';
        card.style.transform = 'translateY(20px)';
        card.style.transition = `opacity 0.6s ease ${index * 0.1}s, transform 0.6s ease ${index * 0.1}s`;
        observer.observe(card);
    });
    
    // Observe skill categories
    const skillCategories = document.querySelectorAll('.skill-category');
    skillCategories.forEach((category, index) => {
        category.style.opacity = '0';
        category.style.transform = 'translateY(20px)';
        category.style.transition = `opacity 0.6s ease ${index * 0.1}s, transform 0.6s ease ${index * 0.1}s`;
        observer.observe(category);
    });
}

// Add header scroll effect
let lastScroll = 0;
window.addEventListener('scroll', () => {
    const header = document.querySelector('.header');
    const currentScroll = window.pageYOffset;
    
    if (currentScroll > 100) {
        header.style.boxShadow = '0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)';
    } else {
        header.style.boxShadow = '0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06)';
    }
    
    lastScroll = currentScroll;
});
